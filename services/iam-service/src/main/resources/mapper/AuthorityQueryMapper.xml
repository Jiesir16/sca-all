<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jiesir.z.iam.infrastructure.db.mapper.AuthorityQueryMapper">

    <select id="selectPermCodesByUser" resultType="string">
        SELECT DISTINCT p.code
        FROM iam_user_role ur
                 JOIN iam_role r
                      ON r.id = ur.role_id AND r.tenant_id = ur.tenant_id AND r.status = 1
                 JOIN iam_role_permission rp
                      ON rp.role_id = r.id AND rp.tenant_id = r.tenant_id
                 JOIN iam_permission p
                      ON p.id = rp.perm_id AND p.tenant_id = rp.tenant_id AND p.status = 1
        WHERE ur.tenant_id = #{tenantId}
          AND ur.user_id = #{userId}
    </select>

</mapper>
